CREATE EXTERNAL TABLE nba_table (
    EVENTID STRING,
    EVENTNUM STRING,
    HOMEDESCRIPTION STRING,
    PCTIMESTRING STRING,
    GAME_ID STRING,
    PERIOD STRING,
    PLAYER1_ID STRING,
    PLAYER1_NAME STRING,
    PLAYER1_TEAM_ABBREVIATION STRING,
    PLAYER1_TEAM_CITY STRING,
    PLAYER1_TEAM_ID STRING,
    PLAYER1_TEAM_NICKNAME STRING,
    PLAYER2_ID STRING,
    PLAYER2_NAME STRING,
    PLAYER2_TEAM_ABBREVIATION STRING,
    PLAYER2_TEAM_CITY STRING,
    PLAYER2_TEAM_ID STRING,
    PLAYER2_TEAM_NICKNAME STRING,
    PLAYER3_ID STRING,
    PLAYER3_NAME STRING,
    PLAYER3_TEAM_ABBREVIATION STRING,
    PLAYER3_TEAM_CITY STRING,
    PLAYER3_TEAM_ID STRING,
    PLAYER3_TEAM_NICKNAME STRING,
    SCORE STRING,
    SCOREMARGIN STRING,
    VISITORDESCRIPTION STRING,
    CLEANED_SCORE STRING,
    POINTS_SCORED STRING,
    WINNER STRING,
    LOSER STRING
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
LOCATION '/user/hive/nba_data';

SELECT PLAYER1_TEAM_NICKNAME, SUM(PLAY_SCORE) AS total_points
FROM nba_play_by_play
GROUP BY PLAYER1_TEAM_NICKNAME
ORDER BY total_points DESC
LIMIT 5;

SELECT PERIOD, SUM(POINTS_SCORED) / COUNT(DISTINCT GAME_ID) AS nba_play_by_play
FROM nba_table
WHERE POINTS_SCORED IS NOT NULL AND POINTS_SCORED >= 0
GROUP BY PERIOD
ORDER BY PERIOD;